# 메모리란?
> 메모리, 스와핑, MMU, 캐시 메모리에 대해 알아보자

## 메모리 Memory
주소를 통해 접근하는 매체를 의미한다. 프로세스마다 독립적으로 가지는 논리 주소(가상메모리)와 실제로 올라가는 물리 주소가 있다.
프로그램이 물리적 주소를 결정하는 것을 **주소 바인딩**이라고 한다.

<img src="https://github.com/chunghye98/CS-Archive/assets/57451700/5e1eb9ec-8753-4906-8da1-b27c7ec28d22" width="40%">

### 스와핑
메모리에 적재된 프로세스들 중에는 현재 실행되지 않는 프로세스가 있을 수 있다. 이러한 프로세스들을 임시로 보조기억장치 일부 영역으로 쫓아내고,
그렇게 해서 생긴 메모리의 빈 공간에 다른 프로세스를 적재하여 실행하는 방식을 **스와핑(swapping)** 이라고 한다.

스와핑을 이용하면 프로세스들이 요구하는 메모리 주소 공간의 크기가 실제 메모리 크기보다 큰 경우에도 프로세스들을 동시에 실행할 수 있다.

- **스왑 영역** : 프로세스들이 쫓겨가는 보조 기억 장치의 일부 영역
- **스왑 아웃** : 현재 실행되지 않는 프로세스가 메모리에서 스왑 영역으로 옮겨지는 것
- **스왑 인** : 스왑 영역에 있던 프로세스가 다시 메모리로 옮겨오는 것, 스왑 아웃 되기 전의 물리 주소와는 다른 주소에 적재될 수 있다.


## 메모리 관리 장치 Memory Management Unit, MMU)
논리 주소를 물리 주소로 매핑해주는 **하드웨어 장치**이다. 

MMU는 CPU가 발생시킨 논리 주소에 베이스 레지스터 값을 더해서 논리 주소를 물리 주소로 변환한다.
베이스 레지스터에 15000이 저장되어 있고 논리 주소가 100번지라면, 이 논리 주소는 15100번지로 변환된다.

즉, **베이스 레지스터**는 프로그램의 가장 작은 물리 주소인 프로그램의 첫 물리 주소를 저장하는 것이고, 논리 주소는 프로그램의 시작점으로부터
떨어진 거리이다.

### 메모리 보호 기법
다른 프로그램의 영역을 침범할 수 있는 명령어는 위험하기 때문에 논리 주소 범위를 벗어나는 명령어 실행을 방지하고 실행 중인 프로그램이 다른 프로그램에 영향을 받지 않도록
보호해야 한다. 이는 **한계 레지스터(limit register)** 라는 레지스터가 담당한다.

한계 레지스터는 논리 주소의 최대 크기를 저장한다. 즉, 프로그램의 물리 주소 범위는 베이스 레지스터 값 이상, 베이스 레지스터 값 +
한계 레지스터 값 미만이 된다.

만약 CPU가 한계 레지스터보다 높은 논리 수조에 접근하려고 하면 인터럽트(트랩)을 발생시켜 실행을 중단한다.

이러한 방식으로 하나의 프로그램이 다른 프로그램을 침범하지 못하게 보호할 수 있다.

## 캐시 메모리 Cache Memory
CPU가 메모리에 접근하는 시간은 CPU의 연산 속도보다 느리기 때문에 이를 극복하기 위한 저장 장치가 **캐시 메모리**이다.
캐시 메모리는 CPU와 메모리 사이에 위치하고, 레지스터보다 용량이 크고 메모리보다 빠른 SRAM 기반의 저장 장치이다.

컴퓨터 내부에는 여러 개의 캐시 메모리가 존재한다. 이 캐시 메모리들은 CPU(코어)와 가까운 순서대로 계층을 구성한다. 
코어와 가장 가까운 캐시를 **L1 캐시**, 그 다음 캐시를 **L2 캐시**, 그 다음 가까운 캐시 메모리를 **L3 캐시**라고 부른다.

<img src="https://github.com/chunghye98/CS-Archive/assets/57451700/26aa4767-a60b-42c0-a80f-ea111bbd028f" width="40%">

## 참조 지역성
### 캐시 히트 cache hit
자주 사용될 것으로 예측한 데이터가 실제로 들어맞아 캐시 메모리 내 데이터가 CPU 에서 활용될 경우를 의미한다.

### 캐시 미스 cache miss
자주 사용될 것으로 예측하여 캐시 메모리에 저장했지만, 예측이 틀려 메모리에서 필요한 데이터를 직접 가져와야 하는 경우를 의미한다.

### 캐시 적중률 cache hit ratio
캐시가 히트되는 비율을 의미한다.    
```
캐시 히트 횟수 / (캐시 히트 횟수 + 캐시 미스 횟수)
```

### 참조 지역성의 원리
캐시 메모리가 메모리로부터 가져올 데이터를 결정하기 위해 따르는 원칙이다. CPU가 메모리에 접근할 때의 주된 경향을 바탕으로 만들어졌다.

1. **시간 지역성**
   CPU는 최근에 접근했던 메모리 공간에 다시 접근하려는 경향이 있다.    
    변수에 값을 저장하고 나면 언제든 변수에 다시 접근하여 변수에 저장된 값을 사용할 수 있다.
2. **공간 지역성**    
   접근한 메모리 공간 근처를 접근하려는 경향이 있다.    
   CPU가 실행하려는 프로그램은 보통 관련 데이터들끼리 한데 모여있다. 

## 참고
혼자 공부하는 컴퓨터구조 + 운영체제   