# 데드락이란?
> 데드락에 대해 알아보자

## 데드락(DeadLock, 교착 상태)
 두 개 이상의 프로세스가 각자 가지고 있는 자원을 무작정 기다려 그 어떤 프로세스도 더 이상 진행할 수 없는 상태를 의미한다.

## 데드락 발생 조건
### 1. 상호 배제
한 프로세스가 사용하는 자원을 다른 프로세스가 사용할 수 없을 때, 즉 상호 배제 상황에서 교착 상태가 발생할 수 있다.

### 2. 점유와 대기
자원을 할당받은 상태에서 다른 자원을 할당 받기를 기다리는 상태를 의미한다.

### 3. 비선점
어떤 프로세스도 다른 프로세스의 자원을 강제로 빼앗지 못했기 때문에 교착 상태가 발생한다.

### 4. 원형 대기
프로세스들과 프로세스가 요청 및 할당 받은 자원이 원의 형태를 이루었다면 교착 상태가 발생할 수 있다.
반드시 발생하는 것은 아니다.

## 데드락 해결 방법
### 1. 예방
교착 상태 발생 조건에 부합하지 않게 자원을 분배하는 방식이다.
1. 상호 배제 부정 : 모든 자원을 공유 가능하게 만든다.
2. 점유와 대기 부정 : 특정 프로세스에 자원을 모두 할당하거나, 할당하지 않는 방식으로 만든다. 자원의 활용률이 낮아질 수 있다.
3. 비선점 부정 : 자원을 빼앗을 수 있게 만든다. 모든 자원이 선점 가능한 것은 아니다(ex. 프린터)
4. 원형 대기 부정 : 모든 자원에 번호를 붙여 순서대로 자원을 할당하는 방식이다. 모든 자원에 번호를 붙이는 일은 간단한 일이 아니다.

### 2. 회피
프로세스들에 배분할 수 있는 자원의 양을 고려하여 교착 상태가 발생하지 않을 정도의 양만큼만 자원을 배분하는 방법이다.
시스템 상태가 안전 상태에서 안전 상태로 움직이는 경우에만 자원을 할당한다.

- 안전 순서열: 교착 상태 없이 안전하게 프로세스들에 자원을 할당할 수 있는 순서
- 안전 상태: 교착 상태가 발생하지 않고 모든 프로세스가 정상적으로 자원을 할당받고 종료될 수 있는 상태, 즉 안전 순서열이 존재하는 상태
- 불안전 상태: 교착 상태가 발생할 수도 있는 상황

다음과 같은 프로세스가 있다고 가정하자.

| 프로세스 | 요구량 | 현재사용량 |
|------|-----|-------|
| P1   | 10  | 5     |
| P2   | 4   | 2     |
| P3   | 9   | 2     |

- 할당 가능 자원: 12
- 할당한 자원 : 9
- 남은 자원 : 3

안전 순서열: P2 -> P1 -> P3    
즉, 안전상태이다. 이 알고리즘은 은행원 알고리즘이라고도 불린다.

### 3. 검출 및 회복
운영체제는 프로세스들이 자원을 요구할 때마다 모두 할당하며, 교착 상태 발생 여부를 주기적으로 검사한다. 
교착 상태가 검출되면 다음과 같은 방식으로 회복한다.

1. 선점을 통한 회복    
   교착 상태가 해결될 때까지 다른 프로세스로부터 자원을 강제로 빼앗고 한 프로세스에 할당하는 방식
2. 프로세스 강제 종료를 통한 회복    
   교착 상태의 프로세스를 전부 종료할 수 있고, 교착 상태가 없어질 때까지 한 프로세스씩 종료할 수 있다.

### 4. 무시
데드락을 처리하는 데 드는 비용보다 데드락이 발생할 확률이 낮다고 판단되면, 데드락을 무시하고 운영할 수도 있다.

## 참고
혼자 공부하는 컴퓨터구조 + 운영체제   
[tech-interview-for-developer](https://github.com/gyoogle/tech-interview-for-developer/blob/master/Computer%20Science/Operating%20System/DeadLock.md)
